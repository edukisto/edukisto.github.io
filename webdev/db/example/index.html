<!doctype html>
<html lang="ru-luna1918" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-webdev/db/example" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Пример выполнения задания | Караваев С. В.</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="robots" content="noindex, nofollow"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://edukisto.github.io/webdev/db/example/"><meta data-rh="true" property="og:locale" content="ru_luna1918"><meta data-rh="true" name="docusaurus_locale" content="ru-luna1918"><meta data-rh="true" name="docsearch:language" content="ru-luna1918"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Пример выполнения задания | Караваев С. В."><meta data-rh="true" name="description" content="Проектирование БД"><meta data-rh="true" property="og:description" content="Проектирование БД"><link data-rh="true" rel="icon" href="/favicon.ico"><link data-rh="true" rel="canonical" href="https://edukisto.github.io/webdev/db/example/"><link data-rh="true" rel="alternate" href="https://edukisto.github.io/webdev/db/example/" hreflang="ru-luna1918"><link data-rh="true" rel="alternate" href="https://edukisto.github.io/webdev/db/example/" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"09.02.07‑ВД. МДК 09.01","item":"https://edukisto.github.io/webdev/"},{"@type":"ListItem","position":2,"name":"Работа № 2","item":"https://edukisto.github.io/webdev/db/"},{"@type":"ListItem","position":3,"name":"Пример выполнения задания","item":"https://edukisto.github.io/webdev/db/example"}]}</script><link href="/icon.svg" rel="icon" type="image/svg+xml">
<link rel="stylesheet" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.2/css/brands.min.css" integrity="sha256-4QQlrXaLyY/x+ycqCshCD50boi8GEsCP8QEMlQgP/n4=">
<link rel="stylesheet" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css" integrity="sha256-fl23kUuX5ZajbBq7Z8zH8XT4u3HTjJqIxVsmLtFzf5c="><link rel="stylesheet" href="/assets/css/styles.607048fd.css">
<script src="/assets/js/runtime~main.049f4151.js" defer="defer"></script>
<script src="/assets/js/main.cdb5f8b2.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/icon.svg"><div role="region" aria-label="Перейти к основному содержимому"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Перейти к основному содержимому</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/icon.svg" alt="Эмблема МПТ" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/icon.svg" alt="Эмблема МПТ" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Московский приборостроительный техникум</b></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Переключение между темным и светлым режимом (сейчас используется system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Прокрутка к началу" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Главная страница</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/infosec/">10.02.05. МДК 01.04</a><button aria-label="Expand sidebar category &#x27;10.02.05. МДК 01.04&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/webdev/">09.02.07‑ВД. МДК 09.01</a><button aria-label="Collapse sidebar category &#x27;09.02.07‑ВД. МДК 09.01&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/webdev/wares/">АО и ПО</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/webdev/docker/">Работа № 0</a><button aria-label="Expand sidebar category &#x27;Работа № 0&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/webdev/db/">Работа № 2</a><button aria-label="Collapse sidebar category &#x27;Работа № 2&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/webdev/db/purpose/">Цель работы</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/webdev/db/task/">Задание</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/webdev/db/report/">Содержание отчёта</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/webdev/db/theory/">Теоретические сведения</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/webdev/db/example/">Пример выполнения задания</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/webdev/dal/">Работа № 3</a><button aria-label="Expand sidebar category &#x27;Работа № 3&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/webdev/tests/">Работа № 4</a><button aria-label="Expand sidebar category &#x27;Работа № 4&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/webdev/ui/">Работа № 6</a><button aria-label="Expand sidebar category &#x27;Работа № 6&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/webdev-new/">09.02.09</a><button aria-label="Expand sidebar category &#x27;09.02.09&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Навигационная цепочка текущей страницы"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Главная страница" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/webdev/"><span>09.02.07‑ВД. МДК 09.01</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/webdev/db/"><span>Работа № 2</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Пример выполнения задания</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">Содержание этой страницы</button></div><div class="theme-doc-markdown markdown"><header><h1>Пример выполнения задания</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="проектирование-бд">Проектирование БД<a href="#проектирование-бд" class="hash-link" aria-label="Прямая ссылка на Проектирование БД" title="Прямая ссылка на Проектирование БД">​</a></h2>
<p>Выполним диаграмму «сущность — связь» (<i lang="en">ERD</i>).</p>
<figure><p><img decoding="async" loading="lazy" src="/assets/images/conceptual-schema-c79f05377e7fe673178e0472291b3562.svg" width="761" height="252" class="img_ev3q"></p><figcaption>Диаграмма «сущность — связь» (<i lang="en">ERD</i>)</figcaption></figure>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="создание-бд">Создание БД<a href="#создание-бд" class="hash-link" aria-label="Прямая ссылка на Создание БД" title="Прямая ссылка на Создание БД">​</a></h2>
<p>Пропускаем этот раздел. БД создана при выполнении предыдущей лабораторной работы.</p>
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="настройка-соединения-между-приложением-бд-исубд">Настройка соединения между приложением БД и СУБД<a href="#настройка-соединения-между-приложением-бд-исубд" class="hash-link" aria-label="Прямая ссылка на Настройка соединения между приложением БД и СУБД" title="Прямая ссылка на Настройка соединения между приложением БД и СУБД">​</a></h2>
<p>Пропускаем этот раздел. Настройка соединения между приложением БД и СУБД проведена при выполнении предыдущей лабораторной работы.</p>
<!-- -->
<!-- -->
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="сценарий-миграции-для-таблицы">Сценарий миграции для таблицы<a href="#сценарий-миграции-для-таблицы" class="hash-link" aria-label="Прямая ссылка на Сценарий миграции для таблицы" title="Прямая ссылка на Сценарий миграции для таблицы">​</a></h2>
<!-- -->
<ol>
<li>
<p>Подайте из каталога <code>docker-project</code> команду на сборку и запуск контейнеров:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> compose up </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--build</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--detach</span><span class="token plain"> --remove-orphans</span><br></span></code></pre></div></div>
</li>
<li>
<p>Подайте команду на запуск командной строки внутри контейнера с <i lang="en">PHP</i>:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">exec</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-it</span><span class="token plain"> project-php /bin/sh</span><br></span></code></pre></div></div>
<p>Все приведённые ниже команды будут выполняться внутри этого контейнера.</p>
</li>
<li>
<p>Описание данных легче начать с главных таблиц — таких, которые не имеют <span>столбцов</span> во внешних ключах. На выполненной нами диаграмме «сущность — связь» (<i lang="en">ERD</i>) заданному правилу соответствуют две сущности: <code>products</code> («Товары») и <code>tags</code> («Теги»). Начнём в алфавитном порядке и создадим модель данных <code>Product</code>.</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">php artisan make:model </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--all</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--api</span><span class="token plain"> Product</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Имя модели имеет значение!</div><div class="admonitionContent_BuS1"><p>Имя модели должно быть <span>именем существительным или словосочетанием с ним</span>. Оно должно быть приведено на английском языке, <strong>в единственном числе</strong> и должно быть записано в верхнем верблюжьем регистре (<i lang="en">UpperCamelCase</i>).</p><p>Причина в том, что <i lang="en">Laravel</i> опирается на имя модели при именовании компонентов (модулей), причём для классов приложения БД фреймворк использует форму единственного числа, а для таблиц БД подбирает форму множественного числа — регулярную или нерегулярную: <i lang="en">Product</i> — <i lang="en">products</i>, <i lang="en">Student</i> — <i lang="en">students</i>, но <i lang="en">Aircraft</i> (ед. ч.) — <i lang="en">aircraft</i> (мн. ч.), <i lang="en">Child</i> — <i lang="en">children</i>, <i lang="en">Data</i> (ед. ч.) — <i lang="en">data</i> (мн. ч.), <i lang="en">Man</i> — <i lang="en">men</i>, <i lang="en">Species</i> (ед. ч.) — <i lang="en">species</i> (мн. ч.).</p></div></div>
<p>Должно быть выведено:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">INFO Model</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">..</span><span class="token plain">. created successfully.</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">INFO Migration</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">..</span><span class="token plain">. created successfully.</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">..</span><span class="token plain">.</span><br></span></code></pre></div></div>
<p>В результате выполнения команды должны быть созданы следующие модули:</p>
<ul>
<li>сценарий миграции БД — в файле <code>database/migrations/YYYY_MM_DD_hhmmss_create_products_table.php</code> (элементы <code>YYYY</code>, <code>MM</code>, <code>DD</code>, <code>hh</code>, <code>mm</code> и <code>ss</code> обозначают соответственно год, месяц, день, час, минуту и секунду создания сценария);</li>
<li>модель объекта предметной области на уровне приложения БД — в файле <code>app/Models/Product.php</code>;</li>
<li>сеялка, заполняющая БД, — в файле <code>database/seeders/ProductSeeder.php</code>;</li>
<li>фабрика, подготавливающая данные для сеялки, — в файле <code>database/factories/ProductFactory.php</code>;</li>
<li>ресурсный контроллер с методами, подходящими для реализации <i lang="en">API</i>, — в файле <code>app/Http/Controllers/ProductController.php</code>;</li>
<li>обработчики для <i lang="en">HTTP</i>­‑запросов на создание и корректировку записи в БД — в файлах <code>app/Http/Requests/StoreProductRequest.php</code> и <code>app/Http/Requests/UpdateProductRequest.php</code>;</li>
<li>политика доступа — в файле <code>app/Policies/ProductPolicy.php</code>.</li>
</ul>
</li>
<li>
<p>Откроем на редактирование файл <code>database/migrations/YYYY_MM_DD_hhmmss_create_products_table.php</code>.</p>
</li>
</ol>
<p>Сценарий миграции БД записан на языке программирования <i lang="en">PHP</i>. Сценарий представлен анонимным классом, который наследует от класса <code class="language-php">Migration</code> и переопределяет методы <code class="language-php">up</code> и <code class="language-php">down</code>, отвечающие соответственно за создание и удаление таблицы <code class="language-sql">products</code>. Рассмотрим эти методы подробнее.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="метод-up">Метод <code class="language-php">up</code><a href="#метод-up" class="hash-link" aria-label="Прямая ссылка на метод-up" title="Прямая ссылка на метод-up">​</a></h3>
<p>Метод <code class="language-php">up</code> по умолчанию реализован следующим образом:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockTitle_OeMC">Фрагмент файла database/migrations/YYYY_MM_DD_hhmmss_create_products_table.php</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">public</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(221, 87%, 60%)">up</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token keyword return-type" style="color:hsl(301, 63%, 40%)">void</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token class-name static-context" style="color:hsl(35, 99%, 36%)">Schema</span><span class="token operator" style="color:hsl(221, 87%, 60%)">::</span><span class="token function" style="color:hsl(221, 87%, 60%)">create</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string single-quoted-string" style="color:hsl(119, 34%, 47%)">&#x27;products&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token class-name type-declaration" style="color:hsl(35, 99%, 36%)">Blueprint</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$table</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$table</span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">id</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$table</span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">timestamps</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<p>В приведённом фрагменте исходного кода происходит статический (через <code class="language-php">::</code>) вызов из класса <code class="language-php">Schema</code> метода <code class="language-php">create</code> с двумя аргументами: именем создаваемой таблицы (<code class="language-php">&#x27;products&#x27;</code>) и анонимной функцией обратного вызова, которая автоматически принимает в качестве параметра объект <code class="language-php">$table</code> класса <code class="language-php">Blueprint</code>. Это — так называемый <em>строитель схем</em>; он позволяет описать структуру таблицы БД как на <i lang="en">SQL</i>, так и посредством конструктора.</p>
<p>При вызове метода <code class="language-php">up</code> происходит следующее (на примере СУБД <i lang="en">MySQL</i>):</p>
<ul>
<li>вызов метода <code class="language-php">id</code> создаёт в таблице <code class="language-sql">products</code> столбец <code class="language-sql">id</code> <span>беззнакового целого типа данных</span> <code class="language-sql">BIGINT UNSIGNED</code> с запретом пустых значений (<code class="language-sql">NOT NULL</code>), автоинкрементом и первичным ключом;</li>
<li>вызов метода <code class="language-php">timestamps</code> создаёт в таблице <code class="language-sql">products</code> два <span>столбца</span> <span>типа данных</span> <code class="language-sql">TIMESTAMP</code> для меток времени создания (<code class="language-sql">created_at</code>) и последнего изменения (<code class="language-sql">updated_at</code>) <span>строки таблицы</span>.</li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Что ещё умеет строитель схем?</div><div class="admonitionContent_BuS1"><p>Строитель схем, встроенный в <i lang="en">Laravel</i>, располагает множеством методов для описания данных: <a href="https://laravel.com/docs/12.x/migrations#available-column-types" target="_blank" rel="noopener noreferrer">https://laravel.com/docs/12.x/migrations#available-column-types</a>.</p></div></div>
<p>Все методы реализуют «текучий интерфейс» (англ. <i lang="en">fluent interface</i>), т. е. возвращают ссылку на объект, из которого вызваны, поэтому вызовы можно объединять в цепочки для повышения удобочитаемости.</p>
<p>Опишем структуру таблицы.</p>
<ol>
<li>
<p>Для хранения наименования товара добавим столбец <code class="language-sql">name</code> с небольшой максимальной длиной (в символах) и запретом на повтор значений. Добавим в метод <code>up</code> следующий фрагмент исходного кода:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token variable" style="color:hsl(221, 87%, 60%)">$table</span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token keyword type-declaration" style="color:hsl(301, 63%, 40%)">string</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string single-quoted-string" style="color:hsl(119, 34%, 47%)">&#x27;name&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">55</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">collation</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string single-quoted-string" style="color:hsl(119, 34%, 47%)">&#x27;utf8mb4_0900_ai_ci&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">unique</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><br></span></code></pre></div></div>
<p>СУБД <i lang="en">MySQL</i> при миграции БД создаст столбец <code class="language-sql">name</code> <span>типа данных</span> <code class="language-sql">VARCHAR(55)</code>. Кроме того, будет добавлен индекс <code>products_name_unique</code>, запрещающий повторы значений в указанном столбце.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Почему именно 55?</div><div class="admonitionContent_BuS1"><ol>
<li>
<p>Тип данных <code>VARCHAR</code> параметризован максимальной допустимой длиной строки, измеряемой в символах, тогда как на уровне физической схемы БД длина строки измеряется в байтах с учётом набора символов — так называемой «кодировки». Так, набор <code>utf8mb4</code> в <i lang="en">MySQL 8</i> выделяет на каждый символ от 1 до 4 байтов: латинская буква занимает 1 байт, русская — 2 байта и т. д.</p>
<p>Кроме того, <i lang="en">MySQL 8</i> хранит информацию о длине строки (в символах) в <span>значении столбца</span> <span>типа данных</span> <code>VARCHAR</code>: если длина лежит в интервале <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">;</mo><msup><mn>2</mn><mn>8</mn></msup><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0; 2^{8} - 1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">8</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span>, то информация занимает один старший байт; длина в интервале <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><msup><mn>2</mn><mn>8</mn></msup><mo separator="true">;</mo><msup><mn>2</mn><mn>16</mn></msup><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[2^{8}; 2^{16} - 1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em"></span><span class="mopen">[</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">8</span></span></span></span></span></span></span></span></span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">16</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span> означает, что будут заняты два старших байта. Строки большей длины <code>VARCHAR</code> не поддерживает.</p>
<p>Таким образом, при использовании набора символов <code>utf8mb4</code> в <code>VARCHAR</code> можно хранить строку, длина которой в символах не превышает</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mrow><mo fence="true">⌊</mo><mfrac><mrow><msup><mn>2</mn><mn>16</mn></msup><mo>−</mo><mn>1</mn></mrow><mn>4</mn></mfrac><mo fence="true">⌋</mo></mrow><mo>=</mo><mn>16383.</mn></mrow><annotation encoding="application/x-tex">\left\lfloor \frac{2^{16} - 1}{4} \right\rfloor = 16383.</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.4411em;vertical-align:-0.95em"></span><span class="minner"><span class="mopen delimcenter" style="top:0em"><span class="delimsizing size3">⌊</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4911em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">4</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">16</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em"><span class="delimsizing size3">⌋</span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">16383.</span></span></span></span></span>
<p>При этом информация о длине строки (в символах) займёт оба старших байта. На 1 Б можно записать информацию о такой длине строки, которая в символах не превышает</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mrow><mo fence="true">⌊</mo><mfrac><mrow><msup><mn>2</mn><mn>8</mn></msup><mo>−</mo><mn>1</mn></mrow><mn>4</mn></mfrac><mo fence="true">⌋</mo></mrow><mo>=</mo><mn>63.</mn></mrow><annotation encoding="application/x-tex">\left\lfloor \frac{2^{8} - 1}{4} \right\rfloor = 63.</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.4411em;vertical-align:-0.95em"></span><span class="minner"><span class="mopen delimcenter" style="top:0em"><span class="delimsizing size3">⌊</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4911em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">4</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">8</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em"><span class="delimsizing size3">⌋</span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">63.</span></span></span></span></span>
</li>
<li>
<p>Поисковые системы ограничивают длину заголовка веб­‑страницы. Заголовок сайта МПТ в поисковой выдаче <i lang="en">Google</i> ограничен приблизительно 55 знаками.</p>
<div class="figure"><p><img decoding="async" loading="lazy" src="/assets/images/truncated-title-in-google-c90fd6bf3522e15168e05b484c07eb3d.webp" width="730" height="259" class="img_ev3q"></p></div>
<!-- -->
<!-- -->
<!-- -->
<p>Конечно, в заголовке веб­‑страницы обычно выводят не только название самой веб­‑страницы, но и название сайта. Поэтому следует ориентироваться на число 55 (или меньшее) как на максимальную допустимую длину наименования товара.</p>
</li>
</ol></div></div>
</li>
<li>
<p>Добавим столбец для хранения цены товара. Добавим в метод <code>up</code> следующий фрагмент исходного кода:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token variable" style="color:hsl(221, 87%, 60%)">$table</span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">decimal</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string single-quoted-string" style="color:hsl(119, 34%, 47%)">&#x27;price&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">7</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">index</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><br></span></code></pre></div></div>
<p>СУБД <i lang="en">MySQL</i> при миграции БД создаст столбец <code class="language-sql">price</code> <span>типа данных</span> <code class="language-sql">DECIMAL(7, 2)</code>. Он позволит хранить 7­‑разрядное число, два младших разряда которого отведены под дробную часть (например, копейки или центы). Таким образом, возможные <span>значения столбца</span> будут лежать в интервале <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mo>−</mo><mn>99999</mn><mo separator="true">,</mo><mn>99</mn><mo separator="true">;</mo><mn>99999</mn><mo separator="true">,</mo><mn>99</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[-99999,99; 99999,99]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">[</span><span class="mord">−</span><span class="mord">99999</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord">99</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord">99999</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord">99</span><span class="mclose">]</span></span></span></span>. Благодаря методу <code>index</code> значения столбца будут проходить индексацию при вставке, что ускорит поиск.</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Справка</div><div class="admonitionContent_BuS1"><p>Точность <code class="language-sql">DECIMAL</code> зависит от СУБД, а точность <code class="language-sql">NUMERIC</code> определена в стандарте <i lang="en">SQL</i>. В <i lang="en">MySQL</i> эти <span>типы данных</span> реализованы одинаково.</p></div></div>
<div class="theme-admonition theme-admonition-danger admonition_xJq3 alert alert--danger"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>Не используйте <code>float</code> или <code>double</code> для денежных величин</div><div class="admonitionContent_BuS1"><p>Широко известные <span>типы данных</span>, реализующие стандарт <i lang="en">IEEE 754</i>, не вполне пригодны для денежных операций, так как не обеспечивают должную точность представления чисел. Так, при использовании <code>float</code> или <code>double</code> сумма 0,10 ₽ и 0,70 ₽ будет записана как 0,7⁠(9) ₽.</p></div></div>
</li>
<li>
<p>Добавим столбец для описания товара. Добавим в метод <code>up</code> следующий фрагмент исходного кода:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token variable" style="color:hsl(221, 87%, 60%)">$table</span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">text</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string single-quoted-string" style="color:hsl(119, 34%, 47%)">&#x27;description&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">collation</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string single-quoted-string" style="color:hsl(119, 34%, 47%)">&#x27;utf8mb4_0900_ai_ci&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><br></span></code></pre></div></div>
<p>СУБД <i lang="en">MySQL</i> при миграции БД создаст столбец <code class="language-sql">description</code> <span>типа данных</span> <code class="language-sql">TEXT</code>.</p>
</li>
<li>
<p>Добавим столбец, позволяющий хранить число единиц товара на складе. Добавим в метод <code>up</code> следующий фрагмент исходного кода:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token variable" style="color:hsl(221, 87%, 60%)">$table</span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">integer</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string single-quoted-string" style="color:hsl(119, 34%, 47%)">&#x27;quantity&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">unsigned</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">default</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><br></span></code></pre></div></div>
<p>СУБД <i lang="en">MySQL</i> при миграции БД создаст столбец <code class="language-sql">quantity</code> целого неотрицательного <span>типа данных</span> <code class="language-sql">INT UNSIGNED</code> со значением <code>0</code> по умолчанию. Таким образом, если <span>значение столбца</span> не задано при вставке, то считается, что на складе не осталось данного товара.</p>
</li>
<li>
<p>Так как товар может быть снят с продажи, потребуется столбец бу́лева <span>типа данных</span>. Добавим в метод <code>up</code> следующий фрагмент исходного кода:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token variable" style="color:hsl(221, 87%, 60%)">$table</span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">boolean</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string single-quoted-string" style="color:hsl(119, 34%, 47%)">&#x27;available&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">default</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token constant boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><br></span></code></pre></div></div>
<p>СУБД <i lang="en">MySQL</i> при миграции БД создаст столбец <code class="language-sql">available</code> целочисленного <span>типа данных</span> <code class="language-sql">TINYINT</code> со значением <code>0</code> по умолчанию. Другими словами, если <span>значение столбца</span> не задано при вставке, то считается, что товар недоступен для заказа. Обратного эффекта можно добиться, заменив <code>default(false)</code> на <code>default(true)</code> в сценарии.</p>
</li>
<li>
<p>Убедимся, что метод <code class="language-php">up</code> приобрёл следующий вид:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockTitle_OeMC">Фрагмент файла database/migrations/YYYY_MM_DD_hhmmss_create_products_table.php</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">public</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(221, 87%, 60%)">up</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token keyword return-type" style="color:hsl(301, 63%, 40%)">void</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token class-name static-context" style="color:hsl(35, 99%, 36%)">Schema</span><span class="token operator" style="color:hsl(221, 87%, 60%)">::</span><span class="token function" style="color:hsl(221, 87%, 60%)">create</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string single-quoted-string" style="color:hsl(119, 34%, 47%)">&#x27;products&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token class-name type-declaration" style="color:hsl(35, 99%, 36%)">Blueprint</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$table</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$table</span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">id</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$table</span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token keyword type-declaration" style="color:hsl(301, 63%, 40%)">string</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string single-quoted-string" style="color:hsl(119, 34%, 47%)">&#x27;name&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">55</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">collation</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string single-quoted-string" style="color:hsl(119, 34%, 47%)">&#x27;utf8mb4_0900_ai_ci&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">unique</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$table</span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">decimal</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string single-quoted-string" style="color:hsl(119, 34%, 47%)">&#x27;price&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">7</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">index</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$table</span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">text</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string single-quoted-string" style="color:hsl(119, 34%, 47%)">&#x27;description&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">collation</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string single-quoted-string" style="color:hsl(119, 34%, 47%)">&#x27;utf8mb4_0900_ai_ci&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$table</span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">integer</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string single-quoted-string" style="color:hsl(119, 34%, 47%)">&#x27;quantity&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">unsigned</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">default</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$table</span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">boolean</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string single-quoted-string" style="color:hsl(119, 34%, 47%)">&#x27;available&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">default</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token constant boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$table</span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">timestamps</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="метод-down">Метод <code class="language-php">down</code><a href="#метод-down" class="hash-link" aria-label="Прямая ссылка на метод-down" title="Прямая ссылка на метод-down">​</a></h3>
<p>Метод <code class="language-php">down</code> оставим в исходном виде:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockTitle_OeMC">Фрагмент файла database/migrations/YYYY_MM_DD_hhmmss_create_products_table.php</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">public</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(221, 87%, 60%)">down</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token keyword return-type" style="color:hsl(301, 63%, 40%)">void</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token class-name static-context" style="color:hsl(35, 99%, 36%)">Schema</span><span class="token operator" style="color:hsl(221, 87%, 60%)">::</span><span class="token function" style="color:hsl(221, 87%, 60%)">dropIfExists</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string single-quoted-string" style="color:hsl(119, 34%, 47%)">&#x27;products&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<p>Если таблица <code class="language-sql">products</code> существует, то она будет удалена при откате миграции.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="отладка">Отладка<a href="#отладка" class="hash-link" aria-label="Прямая ссылка на Отладка" title="Прямая ссылка на Отладка">​</a></h3>
<p>Команда <code>php artisan migrate</code> находит ранее не выполненные сценарии миграции и вызывает реализованные в них методы <code class="language-php">up</code>. Впрочем, перед миграцией следует убедиться, что сценарии не содержат ошибок. Осуществим отладочную печать предложений <i lang="en">SQL</i>, подготовленных <i lang="en">Laravel</i>, подав эту команду с флагом <code>--pretend</code>.</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">php artisan migrate </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--pretend</span><br></span></code></pre></div></div>
<p>Флаг <code class="language-sh">--pretend</code> сигнализирует, что интерпретация сценариев миграции должна быть осуществлена без воздействия на БД. В консоль должны быть выведены примерно такие предложения <i lang="en">SQL</i> (исходный код отформатирован в дидактических целях):</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">TABLE</span><span class="token plain"> products </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  id </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">BIGINT</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">UNSIGNED</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">AUTO_INCREMENT</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">KEY</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  name </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">VARCHAR</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">55</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">COLLATE</span><span class="token plain"> utf8mb4_0900_ai_ci </span><span class="token operator" style="color:hsl(221, 87%, 60%)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">NULL</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  price </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">DECIMAL</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">7</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">NULL</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  description </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">TEXT</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">COLLATE</span><span class="token plain"> utf8mb4_0900_ai_ci </span><span class="token operator" style="color:hsl(221, 87%, 60%)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">NULL</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  quantity </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">INT</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">UNSIGNED</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">DEFAULT</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  available </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">TINYINT</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">DEFAULT</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  created_at </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">TIMESTAMP</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">NULL</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  updated_at </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">TIMESTAMP</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">NULL</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">CHARACTER</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">SET</span><span class="token plain"> utf8mb4 </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">COLLATE</span><span class="token plain"> utf8mb4_unicode_ci</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">TABLE</span><span class="token plain"> products </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">ADD</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">UNIQUE</span><span class="token plain"> products_name_unique</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">name</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">TABLE</span><span class="token plain"> products </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">ADD</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">INDEX</span><span class="token plain"> products_price_index</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">price</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="выполнение-миграции">Выполнение миграции<a href="#выполнение-миграции" class="hash-link" aria-label="Прямая ссылка на Выполнение миграции" title="Прямая ссылка на Выполнение миграции">​</a></h3>
<!-- -->
<!-- -->
<ol>
<li>
<p>Для выполнения всех сценариев миграции, которые размещены в каталоге <code>database/migrations/</code> и не были выполнены ранее, следует подать ту же команду <code class="language-sh">php artisan migrate</code>, но без флага <code class="language-sh">--pretend</code>. Сценарии будут выполнены в порядке возрастания даты и времени, указанных в именах файлов.</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">php artisan migrate</span><br></span></code></pre></div></div>
<p>Должно быть выведено:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">INFO Running migrations.</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">..</span><span class="token plain">._create_products_table </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">..</span><span class="token plain">. DONE</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Если возникла проблема</div><div class="admonitionContent_BuS1"><p>Если при выполнении команды не был найден сценарий миграции, то следует выполнить команду <code class="language-sh">composer dump-autoload</code> из каталога проекта.</p></div></div>
</li>
<li>
<p>Для проверки повторно подадим команду</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">php artisan migrate</span><br></span></code></pre></div></div>
<p>Должно быть выведено:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">INFO Nothing to migrate.</span><br></span></code></pre></div></div>
<p>Это означает, что невыполненных сценариев миграции не осталось.</p>
<!-- -->
</li>
<li>
<p>Запустим в браузере <i lang="en">phpMyAdmin</i> (<a href="http://localhost:8081/" target="_blank" rel="noopener noreferrer">http://localhost:8081/</a>) и откроем в нём БД <code>laravel</code>.</p>
<p>Обратим внимание, что <i lang="en">Laravel</i> создал в БД таблицу <code class="language-sql">migrations</code>, сценарий для которой отсутствует в каталоге <code>database/migrations/</code>. В этой таблице <i lang="en">Laravel</i> регистрирует выполненные миграции.</p>
<p>Со вкладки <i lang="en">SQL</i> подадим запрос на извлечение всех записей из этой таблицы:</p>
<!-- -->
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">*</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">FROM</span><span class="token plain"> migrations</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><br></span></code></pre></div></div>
<!-- -->
<p>Должно быть выведено:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">+----+-----------------------------------------+-------+</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">id</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> migration                               </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> batch </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">+----+-----------------------------------------+-------+</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain">  </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> 0001_01_01_000000_create_users_table    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain">     </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain">  </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> 0001_01_01_000001_create_cache_table    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain">     </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain">  </span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> 0001_01_01_000002_create_jobs_table     </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain">     </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain">  </span><span class="token number" style="color:hsl(35, 99%, 36%)">4</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> 2025_04_05_232750_create_products_table </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain">     </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">+----+-----------------------------------------+-------+</span><br></span></code></pre></div></div>
<p>Значение в столбце <code>batch</code> указывает на порядковый номер <span>сеанса</span>, в рамках которого выполнен сценарий миграции. Впервые мы подали команду <code>php artisan migrate</code> при установке <i lang="en">Laravel</i>. Во время второго сеанса появилась таблица <code>products</code>.</p>
</li>
<li>
<p>Убедимся в правильности структуры таблицы <code class="language-sql">products</code>. Из <i lang="en">phpMyAdmin</i>, со вкладки <i lang="en">SQL</i>, подадим запрос:</p>
<!-- -->
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">DESCRIBE</span><span class="token plain"> products</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><br></span></code></pre></div></div>
<p>Должно быть выведено:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">+-------------+-----------------+------+-----+---------+----------------+</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> Field       </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> Type            </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> Null </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> Key </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> Default </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> Extra          </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">+-------------+-----------------+------+-----+---------+----------------+</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">id</span><span class="token plain">          </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> bigint unsigned </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> NO   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> PRI </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> NULL    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> auto_increment </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> name        </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> varchar</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">55</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">     </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> NO   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> UNI </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> NULL    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain">                </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> price       </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> decimal</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">7,2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> NO   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> MUL </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> NULL    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain">                </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> description </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> text            </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> NO   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain">     </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> NULL    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain">                </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> quantity    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> int unsigned    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> NO   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain">     </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain">       </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain">                </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> available   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> tinyint</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">      </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> NO   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain">     </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain">       </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain">                </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> created_at  </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> timestamp       </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> YES  </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain">     </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> NULL    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain">                </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> updated_at  </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> timestamp       </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> YES  </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain">     </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> NULL    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain">                </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">+-------------+-----------------+------+-----+---------+----------------+</span><br></span></code></pre></div></div>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="отношение-1м">Отношение 1:М<a href="#отношение-1м" class="hash-link" aria-label="Прямая ссылка на Отношение 1:М" title="Прямая ссылка на Отношение 1:М">​</a></h2>
<p>Сущности <code>products</code> («Товары»)  и <code>images</code> («Изображения») в <span>реляционной модели данных</span> по требованию заказчика <span>связаны</span> отношением «один ко многим»: на каждом изображении представлен <strong>один и только один</strong> товар, тогда как каждый товар может не быть представлен ни на одном изображении, а равно может быть представлен на одном или <strong>многих</strong> изображениях.</p>
<ol>
<li>
<p>Создадим связанную с сущностью <code>images</code> модель данных <code>Image</code> и несколько шаблонов компонентов (модулей) для приложения БД.</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">php artisan make:model </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--all</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--api</span><span class="token plain"> Image</span><br></span></code></pre></div></div>
<p>Должно быть выведено:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">INFO Model </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">app/Models/Image.php</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> created successfully.</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">INFO Policy </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">app/Policies/ImagePolicy.php</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> created successfully.</span><br></span></code></pre></div></div>
</li>
<li>
<p>Откроем на редактирование файл <code>database/migrations/YYYY_MM_DD_hhmmss_create_images_table.php</code>.</p>
</li>
<li>
<p>Создадим <span>атрибут внешнего ключа</span> и сам ключ на таблицу «Продукты»:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token variable" style="color:hsl(221, 87%, 60%)">$table</span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">foreignId</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string single-quoted-string" style="color:hsl(119, 34%, 47%)">&#x27;product_id&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">constrained</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">onDelete</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string single-quoted-string" style="color:hsl(119, 34%, 47%)">&#x27;CASCADE&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">onUpdate</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string single-quoted-string" style="color:hsl(119, 34%, 47%)">&#x27;RESTRICT&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Важно!</div><div class="admonitionContent_BuS1"><p>Имя атрибута внешнего ключа должно состоять из имени главной таблицы в единственном числе, подчёркивания и имени атрибута первичного ключа главной таблицы. В данном случае атрибут внешнего ключа <code>product_id</code> в подчинённой таблице (<code>images</code>) будет получать значения первичного ключа из атрибута <code>id</code> главной таблицы (<code>products</code>).</p><p>Тип атрибута внешнего ключа также зависит от типа атрибута первичного ключа. Если атрибут первичного ключа создан методом <code>id()</code>, то атрибут внешнего ключа следует создать методом <code>unsignedBigInteger()</code>. Тогда атрибуты получат один и тот же беззнаковый целочисленный тип. В противном случае ключи могут оказаться несовместимы.</p><p>Методы <code>onDelete()</code> и <code>onUpdate()</code> задают ограничения внешнего ключа, позволяющие контролировать их целостность при удалении кортежей из главной таблицы и изменении значения первичного ключа кортежа в главной таблице (соответственно). Примеры:</p><ul>
<li><code>onDelete(&#x27;CASCADE&#x27;)</code> при удалении кортежа товара удалит все подчинённые кортежи изображений;</li>
<li><code>onDelete(&#x27;RESTRICT&#x27;)</code> запретит удалять кортеж товара, если с ним связан хотя бы один кортеж изображения;</li>
<li><code>-&gt;onUpdate(&#x27;RESTRICT&#x27;)</code> запретит изменять значение первичного ключа в главной таблице.</li>
</ul></div></div>
</li>
<li>
<p>Для хранения пути к графическому файлу добавим строковый столбец длиной 255 символов и запретим в нём повтор значений. Акцентозависимый, но регистронезависимый алгоритм сравнения строк <code>utf8mb4_0900_as_ci</code> обеспечит совместимость с <i lang="en">Windows</i>. Добавим в метод <code>up</code> следующий фрагмент исходного кода:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token variable" style="color:hsl(221, 87%, 60%)">$table</span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token keyword type-declaration" style="color:hsl(301, 63%, 40%)">string</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string single-quoted-string" style="color:hsl(119, 34%, 47%)">&#x27;path&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">255</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">collation</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string single-quoted-string" style="color:hsl(119, 34%, 47%)">&#x27;utf8mb4_0900_as_ci&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">unique</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><br></span></code></pre></div></div>
</li>
<li>
<p>Убедимся, что метод <code class="language-php">up</code> приобрёл следующий вид:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockTitle_OeMC">Фрагмент файла database/migrations/YYYY_MM_DD_hhmmss_create_images_table.php</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">public</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(221, 87%, 60%)">up</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token keyword return-type" style="color:hsl(301, 63%, 40%)">void</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token class-name static-context" style="color:hsl(35, 99%, 36%)">Schema</span><span class="token operator" style="color:hsl(221, 87%, 60%)">::</span><span class="token function" style="color:hsl(221, 87%, 60%)">create</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string single-quoted-string" style="color:hsl(119, 34%, 47%)">&#x27;images&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token class-name type-declaration" style="color:hsl(35, 99%, 36%)">Blueprint</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$table</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$table</span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">id</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$table</span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">foreignId</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string single-quoted-string" style="color:hsl(119, 34%, 47%)">&#x27;product_id&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">constrained</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">onDelete</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string single-quoted-string" style="color:hsl(119, 34%, 47%)">&#x27;CASCADE&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">onUpdate</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string single-quoted-string" style="color:hsl(119, 34%, 47%)">&#x27;RESTRICT&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$table</span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token keyword type-declaration" style="color:hsl(301, 63%, 40%)">string</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string single-quoted-string" style="color:hsl(119, 34%, 47%)">&#x27;path&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">255</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">collation</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string single-quoted-string" style="color:hsl(119, 34%, 47%)">&#x27;utf8mb4_0900_as_ci&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">unique</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$table</span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">timestamps</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
</li>
<li>
<p>Подадим команду на вывод предложений <i lang="en">SQL</i>, подготовленных <i lang="en">Laravel</i>:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">php artisan migrate </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--pretend</span><br></span></code></pre></div></div>
<p>Должно быть выведено (исходный код отформатирован для удобства чтения):</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">TABLE</span><span class="token plain"> images </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  id </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">BIGINT</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">UNSIGNED</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">AUTO_INCREMENT</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">KEY</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  product_id </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">BIGINT</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">UNSIGNED</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">NULL</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  path </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">VARCHAR</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">255</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">COLLATE</span><span class="token plain"> utf8mb4_0900_as_ci </span><span class="token operator" style="color:hsl(221, 87%, 60%)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">NULL</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  created_at </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">TIMESTAMP</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">NULL</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  updated_at </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">TIMESTAMP</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">NULL</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">CHARACTER</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">SET</span><span class="token plain"> utf8mb4 </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">COLLATE</span><span class="token plain"> utf8mb4_unicode_ci</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">TABLE</span><span class="token plain"> images</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">ADD</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">CONSTRAINT</span><span class="token plain"> images_product_id_foreign</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">FOREIGN</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">product_id</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">REFERENCES</span><span class="token plain"> products </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">ON</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">DELETE</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">CASCADE</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">ON</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">UPDATE</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">RESTRICT</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">TABLE</span><span class="token plain"> images</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">ADD</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">UNIQUE</span><span class="token plain"> images_path_unique </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><br></span></code></pre></div></div>
</li>
<li>
<p>Подадим команду на выполнение сценариев миграции:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">php artisan migrate</span><br></span></code></pre></div></div>
</li>
<li>
<p>Убедимся в правильности структуры таблицы <code class="language-sql">images</code>. Из <i lang="en">phpMyAdmin</i>, со вкладки <i lang="en">SQL</i>, подадим запрос:</p>
<!-- -->
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">DESCRIBE</span><span class="token plain"> images</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><br></span></code></pre></div></div>
<p>Должно быть выведено:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">+------------+-----------------+------+-----+---------+----------------+</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> Field      </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> Type            </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> Null </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> Key </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> Default </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> Extra          </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">+------------+-----------------+------+-----+---------+----------------+</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">id</span><span class="token plain">         </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> bigint unsigned </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> NO   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> PRI </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> NULL    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> auto_increment </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> product_id </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> bigint unsigned </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> NO   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> MUL </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> NULL    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain">                </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> path       </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> varchar</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">255</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> NO   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> UNI </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> NULL    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain">                </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> created_at </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> timestamp       </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> YES  </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain">     </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> NULL    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain">                </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> updated_at </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> timestamp       </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> YES  </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain">     </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> NULL    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain">                </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">+------------+-----------------+------+-----+---------+----------------+</span><br></span></code></pre></div></div>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="отношение-мм">Отношение М:М<a href="#отношение-мм" class="hash-link" aria-label="Прямая ссылка на Отношение М:М" title="Прямая ссылка на Отношение М:М">​</a></h2>
<p>Сущности <code>tags</code> («Теги») и <code>products</code> («Товары») в <span>реляционной модели данных</span> <span>связаны</span> отношением «многие ко многим»: каждым тегом могут быть помечены <strong>многие</strong> товары, и каждый товар может быть помечен <strong>многими</strong> тегами.</p>
<ol>
<li>
<p>Создадим связанную с сущностью <code>tags</code> модель данных <code>Tag</code> и несколько шаблонов компонентов (модулей) для приложения БД.</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">php artisan make:model </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--all</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--api</span><span class="token plain"> Tag</span><br></span></code></pre></div></div>
<p>Должно быть выведено:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">INFO  Model </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">app/Models/Tag.php</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> created successfully.</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">INFO  Policy </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">app/Policies/TagPolicy.php</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> created successfully.</span><br></span></code></pre></div></div>
</li>
<li>
<p>Откроем на редактирование файл <code>database/migrations/YYYY_MM_DD_hhmmss_create_tags_table.php</code>.</p>
</li>
<li>
<p>Для хранения наименования тега добавим строковый столбец длиной 55 символов и запретим в нём повторяющиеся значения. Добавим в метод <code>up</code> следующий фрагмент исходного кода:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token variable" style="color:hsl(221, 87%, 60%)">$table</span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token keyword type-declaration" style="color:hsl(301, 63%, 40%)">string</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string single-quoted-string" style="color:hsl(119, 34%, 47%)">&#x27;label&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">55</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">collation</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string single-quoted-string" style="color:hsl(119, 34%, 47%)">&#x27;utf8mb4_0900_ai_ci&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">unique</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><br></span></code></pre></div></div>
</li>
<li>
<p>Убедимся, что метод <code class="language-php">up</code> приобрёл следующий вид:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockTitle_OeMC">Фрагмент файла database/migrations/YYYY_MM_DD_hhmmss_create_tags_table.php</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">public</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(221, 87%, 60%)">up</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token keyword return-type" style="color:hsl(301, 63%, 40%)">void</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token class-name static-context" style="color:hsl(35, 99%, 36%)">Schema</span><span class="token operator" style="color:hsl(221, 87%, 60%)">::</span><span class="token function" style="color:hsl(221, 87%, 60%)">create</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string single-quoted-string" style="color:hsl(119, 34%, 47%)">&#x27;tags&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token class-name type-declaration" style="color:hsl(35, 99%, 36%)">Blueprint</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$table</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$table</span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">id</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$table</span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token keyword type-declaration" style="color:hsl(301, 63%, 40%)">string</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string single-quoted-string" style="color:hsl(119, 34%, 47%)">&#x27;label&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">55</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">collation</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string single-quoted-string" style="color:hsl(119, 34%, 47%)">&#x27;utf8mb4_0900_ai_ci&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">unique</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$table</span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">timestamps</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
</li>
<li>
<p>Подадим команду на вывод предложений <i lang="en">SQL</i>, подготовленных <i lang="en">Laravel</i>:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">php artisan migrate </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--pretend</span><br></span></code></pre></div></div>
<p>Должно быть выведено (исходный код отформатирован для удобства чтения):</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">TABLE</span><span class="token plain"> tags </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  id </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">BIGINT</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">UNSIGNED</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">AUTO_INCREMENT</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">KEY</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  label </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">VARCHAR</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">55</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">COLLATE</span><span class="token plain"> utf8mb4_0900_ai_ci </span><span class="token operator" style="color:hsl(221, 87%, 60%)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">NULL</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  created_at </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">TIMESTAMP</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">NULL</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  updated_at </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">TIMESTAMP</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">NULL</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">CHARACTER</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">SET</span><span class="token plain"> utf8mb4 </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">COLLATE</span><span class="token plain"> utf8mb4_unicode_ci</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">TABLE</span><span class="token plain"> tags </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">ADD</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">UNIQUE</span><span class="token plain"> tags_label_unique</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">label</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><br></span></code></pre></div></div>
</li>
<li>
<p>Подадим команду на выполнение сценариев миграции:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">php artisan migrate</span><br></span></code></pre></div></div>
</li>
<li>
<p>Убедимся в правильности структуры таблицы <code class="language-sql">tags</code>. Из <i lang="en">phpMyAdmin</i>, со вкладки <i lang="en">SQL</i>, подадим запрос:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">DESCRIBE</span><span class="token plain"> tags</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><br></span></code></pre></div></div>
<p>Должно быть выведено:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">+------------+-----------------+------+-----+---------+----------------+</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> Field      </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> Type            </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> Null </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> Key </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> Default </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> Extra          </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">+------------+-----------------+------+-----+---------+----------------+</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">id</span><span class="token plain">         </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> bigint unsigned </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> NO   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> PRI </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> NULL    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> auto_increment </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> label      </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> varchar</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">55</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">     </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> NO   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> UNI </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> NULL    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain">                </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> created_at </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> timestamp       </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> YES  </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain">     </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> NULL    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain">                </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> updated_at </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> timestamp       </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> YES  </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain">     </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> NULL    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain">                </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">+------------+-----------------+------+-----+---------+----------------+</span><br></span></code></pre></div></div>
</li>
<li>
<p>Создадим модель данных <code>ProductTag</code> и несколько шаблонов компонентов (модулей) для приложения БД, в т. ч. <strong>сценарий миграции для <i lang="en">pivot</i>­‑таблицы</strong>, которая свяжет таблицы «Тег» и «Товар».</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Имена имеют значение</div><div class="admonitionContent_BuS1"><p>Название модели в этом случае должно быть составлено из имён связываемых моделей, приведённых в единственном числе и перечисленных в алфавитном порядке. Например, <code>ProductTag</code> свяжет модели <code>Product</code> и <code>Tag</code>.</p></div></div>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">php artisan make:model </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--all</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--api</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--pivot</span><span class="token plain"> ProductTag</span><br></span></code></pre></div></div>
<p>Должно быть выведено:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">INFO  Model </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">app/Models/ProductTag.php</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> created successfully.</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">INFO  Policy </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">app/Policies/ProductTagPolicy.php</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> created successfully.</span><br></span></code></pre></div></div>
</li>
<li>
<p>Откроем на редактирование файл <code>database/migrations/YYYY_MM_DD_hhmmss_create_product_tag_table.php</code>.</p>
</li>
<li>
<p>Приведём метод <code class="language-php">up</code> к следующему виду:</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockTitle_OeMC">Фрагмент файла database/migrations/YYYY_MM_DD_hhmmss_create_product_tag_table.php</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">public</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(221, 87%, 60%)">up</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token keyword return-type" style="color:hsl(301, 63%, 40%)">void</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token class-name static-context" style="color:hsl(35, 99%, 36%)">Schema</span><span class="token operator" style="color:hsl(221, 87%, 60%)">::</span><span class="token function" style="color:hsl(221, 87%, 60%)">create</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string single-quoted-string" style="color:hsl(119, 34%, 47%)">&#x27;product_tag&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token class-name type-declaration" style="color:hsl(35, 99%, 36%)">Blueprint</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$table</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$table</span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">id</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$table</span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">foreignId</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string single-quoted-string" style="color:hsl(119, 34%, 47%)">&#x27;product_id&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">constrained</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">onDelete</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string single-quoted-string" style="color:hsl(119, 34%, 47%)">&#x27;CASCADE&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">onUpdate</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string single-quoted-string" style="color:hsl(119, 34%, 47%)">&#x27;RESTRICT&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$table</span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">foreignId</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string single-quoted-string" style="color:hsl(119, 34%, 47%)">&#x27;tag_id&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">constrained</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">onDelete</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string single-quoted-string" style="color:hsl(119, 34%, 47%)">&#x27;CASCADE&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">onUpdate</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string single-quoted-string" style="color:hsl(119, 34%, 47%)">&#x27;RESTRICT&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$table</span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token function" style="color:hsl(221, 87%, 60%)">timestamps</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
</li>
<li>
<p>Подадим команду на вывод предложений <i lang="en">SQL</i>, подготовленных <i lang="en">Laravel</i>:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">php artisan migrate </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--pretend</span><br></span></code></pre></div></div>
<p>Должно быть выведено (исходный код отформатирован для удобства чтения):</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">TABLE</span><span class="token plain"> product_tag </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  id </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">BIGINT</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">UNSIGNED</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">AUTO_INCREMENT</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">KEY</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  product_id </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">BIGINT</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">UNSIGNED</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">NULL</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  tag_id </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">BIGINT</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">UNSIGNED</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">NULL</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  created_at </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">TIMESTAMP</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">NULL</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  updated_at </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">TIMESTAMP</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">NULL</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">CHARACTER</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">SET</span><span class="token plain"> utf8mb4 </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">COLLATE</span><span class="token plain"> utf8mb4_unicode_ci</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">TABLE</span><span class="token plain"> product_tag</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">ADD</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">CONSTRAINT</span><span class="token plain"> product_tag_product_id_foreign</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">FOREIGN</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">product_id</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">REFERENCES</span><span class="token plain"> products </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">ON</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">DELETE</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">CASCADE</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">ON</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">UPDATE</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">RESTRICT</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">TABLE</span><span class="token plain"> product_tag</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">ADD</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">CONSTRAINT</span><span class="token plain"> product_tag_tag_id_foreign</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">FOREIGN</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">tag_id</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">REFERENCES</span><span class="token plain"> TAGS </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">ON</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">DELETE</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">CASCADE</span><span class="token plain"> </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">ON</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">UPDATE</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">RESTRICT</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><br></span></code></pre></div></div>
</li>
<li>
<p>Подадим команду на выполнение сценариев миграции:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">php artisan migrate</span><br></span></code></pre></div></div>
</li>
<li>
<p>Убедимся в правильности структуры таблицы <code class="language-sql">product_tag</code>. Из <i lang="en">phpMyAdmin</i>, со вкладки <i lang="en">SQL</i>, подадим запрос:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">DESCRIBE</span><span class="token plain"> product_tag</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><br></span></code></pre></div></div>
<p>Должно быть выведено:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">+------------+-----------------+------+-----+---------+----------------+</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> Field      </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> Type            </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> Null </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> Key </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> Default </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> Extra          </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">+------------+-----------------+------+-----+---------+----------------+</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">id</span><span class="token plain">         </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> bigint unsigned </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> NO   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> PRI </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> NULL    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> auto_increment </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> product_id </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> bigint unsigned </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> NO   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> MUL </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> NULL    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain">                </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> tag_id     </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> bigint unsigned </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> NO   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> MUL </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> NULL    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain">                </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> created_at </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> timestamp       </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> YES  </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain">     </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> NULL    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain">                </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> updated_at </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> timestamp       </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> YES  </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain">     </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> NULL    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain">                </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">+------------+-----------------+------+-----+---------+----------------+</span><br></span></code></pre></div></div>
</li>
</ol>
<!-- -->
<!-- -->
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="экспорт-бд-для-отчёта">Экспорт БД для отчёта<a href="#экспорт-бд-для-отчёта" class="hash-link" aria-label="Прямая ссылка на Экспорт БД для отчёта" title="Прямая ссылка на Экспорт БД для отчёта">​</a></h2>
<ol>
<li>
<p>В <i lang="en">phpMyAdmin</i> откройте вкладку «Дизайнер», расставьте таблицы так, чтобы все они были видны, а линии не пересекались, и сделайте скриншот.</p>
</li>
<li>
<p>В <i lang="en">phpMyAdmin</i> откройте вкладку «Экспорт», выберите формат <i lang="en">SQL</i> и нажмите кнопку «Экспорт».</p>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="останов-docker">Останов <i lang="en">Docker</i><a href="#останов-docker" class="hash-link" aria-label="Прямая ссылка на останов-docker" title="Прямая ссылка на останов-docker">​</a></h2>
<ol>
<li>
<p>Подайте команду на выход из контейнера с <i lang="en">PHP</i>:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">exit</span><br></span></code></pre></div></div>
</li>
<li>
<p>Подайте команду на останов контейнеров (их состояние сохранится):</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> compose stop</span><br></span></code></pre></div></div>
<p>Впоследствии их можно будет запустить командой:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> compose start</span><br></span></code></pre></div></div>
</li>
</ol>
</div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Страница документа"><a class="pagination-nav__link pagination-nav__link--prev" href="/webdev/db/theory/"><div class="pagination-nav__sublabel">Предыдущая страница</div><div class="pagination-nav__label">Теоретические сведения</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/webdev/dal/"><div class="pagination-nav__sublabel">Следующая страница</div><div class="pagination-nav__label">Разработка веб­‑приложения. Слой доступа к данным и слой бизнес­‑логики</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#проектирование-бд" class="table-of-contents__link toc-highlight">Проектирование БД</a></li><li><a href="#создание-бд" class="table-of-contents__link toc-highlight">Создание БД</a></li><li><a href="#настройка-соединения-между-приложением-бд-исубд" class="table-of-contents__link toc-highlight">Настройка соединения между приложением БД и СУБД</a></li><li><a href="#сценарий-миграции-для-таблицы" class="table-of-contents__link toc-highlight">Сценарий миграции для таблицы</a><ul><li><a href="#метод-up" class="table-of-contents__link toc-highlight">Метод <code class="language-php">up</code></a></li><li><a href="#метод-down" class="table-of-contents__link toc-highlight">Метод <code class="language-php">down</code></a></li><li><a href="#отладка" class="table-of-contents__link toc-highlight">Отладка</a></li><li><a href="#выполнение-миграции" class="table-of-contents__link toc-highlight">Выполнение миграции</a></li></ul></li><li><a href="#отношение-1м" class="table-of-contents__link toc-highlight">Отношение 1:М</a></li><li><a href="#отношение-мм" class="table-of-contents__link toc-highlight">Отношение М:М</a></li><li><a href="#экспорт-бд-для-отчёта" class="table-of-contents__link toc-highlight">Экспорт БД для отчёта</a></li><li><a href="#останов-docker" class="table-of-contents__link toc-highlight">Останов <i>Docker</i></a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Автор</div><ul class="footer__items clean-list"><li class="footer__item"><a href="mailto:s.v.karavaev@mpt.ru" target="_blank" rel="noopener noreferrer" class="footer__link-item">s.v.karavaev@mpt.ru<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">© Караваев С. В., 2023–⁠2025</div></div></div></footer></div>
</body>
</html>